datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}
model Usuario {
  id        Int      @id @default(autoincrement())
  nome      String
  email     String   @unique
  senha     String
  tipo      TipoUsuario // ADMIN, CONDOMINO, PORTEIRO
  createdAt DateTime @default(now())

  Condomino  Condomino?
  Porteiro   Porteiro?
}

model Condomino {
  id           Int @id @default(autoincrement())
  cpf          String   @unique
  telefone     String
  apartamento  String
  andar        Int      @default(0)
  usuarioId    Int      @unique  @default(1)
  usuario      Usuario  @relation(fields: [usuarioId], references: [id])
  
  reservas     Reserva[]
  correspondencias Correspondencia[]
  acessos      Acesso[]
  notificacoes Notificacao[]
}

model Porteiro {
  id        Int @id @default(autoincrement())
  cpf       String @unique
  telefone  String
  turno     String
  usuarioId Int      @unique @default(1)
  usuario   Usuario  @relation(fields: [usuarioId], references: [id])
  acessos          Acesso[]
  correspondencias Correspondencia[]
}

model Visitante {
  id          Int      @id @default(autoincrement())
  nome        String
  documento   String?
  autorizado  Boolean  @default(false)
  acessos     Acesso[]
}

model Entregador {
  id          Int      @id @default(autoincrement())
  nome        String
  empresa     String?
  documento   String?
  autorizado  Boolean  @default(false)
  acessos     Acesso[]
}

model Acesso {
  id            Int       @id @default(autoincrement())
  tipo          TipoAcesso
  dataEntrada   DateTime  @default(now())
  dataSaida     DateTime?
  observacao    String?
  condominoId   Int?
  visitanteId   Int?
  entregadorId  Int?
  porteiroId    Int?

  condomino     Condomino?  @relation(fields: [condominoId], references: [id])
  visitante     Visitante?  @relation(fields: [visitanteId], references: [id])
  entregador    Entregador? @relation(fields: [entregadorId], references: [id])
  porteiro      Porteiro?   @relation(fields: [porteiroId], references: [id])
}

model Correspondencia {
  id              Int       @id @default(autoincrement())
  descricao       String
  tipo            TipoCorrespondencia
  dataRecebimento DateTime  @default(now())
  dataRetirada    DateTime?
  retiradoPor     String?
  porteiroId      Int
  condominoId     Int

  porteiro  Porteiro   @relation(fields: [porteiroId], references: [id])
  condomino Condomino  @relation(fields: [condominoId], references: [id])
}

model Notificacao {
  id           Int      @id @default(autoincrement())
  mensagem     String
  dataEnvio    DateTime @default(now())
  condominoId  Int
  condomino    Condomino @relation(fields: [condominoId], references: [id])
}

model AreaComum {
  id        Int       @id @default(autoincrement())
  nome      String
  descricao String?
  reservas  Reserva[]
}

model Reserva {
  id            Int       @id @default(autoincrement())
  dataReserva   DateTime
  horarioInicio DateTime
  horarioFim    DateTime
  areaId        Int
  condominoId   Int
  area          AreaComum   @relation(fields: [areaId], references: [id])
  condomino     Condomino   @relation(fields: [condominoId], references: [id])
  status        String      @default("pendente")
  criadaEm      DateTime    @default(now())
}

enum TipoAcesso {
  CONDOMINO
  VISITANTE
  ENTREGADOR
}

enum TipoCorrespondencia {
  CARTA
  ENCOMENDA
  DOCUMENTO
  OUTRO
}

enum TipoUsuario {
  ADMIN
  CONDOMINO
  PORTEIRO
}