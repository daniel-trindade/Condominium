datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}
model Usuario {
  id        Int      @id @default(autoincrement())
  nome      String
  email     String   @unique
  senha     String
  tipo      TipoUsuario // ADMIN, CONDOMINO, PORTEIRO
  createdAt DateTime @default(now())

  Condomino  Condomino?
  Porteiro   Porteiro?
}

model Condomino {
  id           Int @id @default(autoincrement())
  cpf          String   @unique
  telefone     String
  apartamento  String
  andar        Int      @default(0)
  usuarioId    Int      @unique  @default(1)
  usuario      Usuario  @relation(fields: [usuarioId], references: [id])
  
  //reservas     Reserva[]
  correspondencias Correspondencia[]
  acessos      Acesso[]
}

model Porteiro {
  id        Int @id @default(autoincrement())
  cpf       String @unique
  telefone  String
  turno     String
  usuarioId Int      @unique @default(1)
  usuario   Usuario  @relation(fields: [usuarioId], references: [id])
}

model Visitante {
  id       Int @id @default(autoincrement())
  nome     String
  cpf      String?
  acessos  Acesso[]
}

model Entregador {
  id       Int @id @default(autoincrement())
  nome     String
  empresa  String?
  acessos  Acesso[]
}

model Correspondencia {
  id              Int @id @default(autoincrement())
  tipo            String
  dataRecebimento DateTime @default(now())
  dataRetirada    DateTime?
  status          String
  destinatarioId  Int
  destinatario    Condomino @relation(fields: [destinatarioId], references: [id])

  @@index([destinatarioId])
}

model Acesso {
  id           Int @id @default(autoincrement())
  tipoPessoa   String
  status       String
  dataEntrada  DateTime @default(now())
  dataSaida    DateTime?
  condominoId  Int?
  visitanteId  Int?
  entregadorId Int?

  condomino    Condomino? @relation(fields: [condominoId], references: [id])
  visitante    Visitante? @relation(fields: [visitanteId], references: [id])
  entregador   Entregador? @relation(fields: [entregadorId], references: [id])

  @@index([condominoId])
  @@index([visitanteId])
  @@index([entregadorId])
}

enum TipoUsuario {
  ADMIN
  CONDOMINO
  PORTEIRO
}